<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Im-Plant | Smart Gardening System</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root{
    --green:#4CAF50;
    --green-dark:#43a047;
    --gray:#9e9e9e;
    --muted:#f5f5f5;
    --red:#f44336;
    --bg:#ffffff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Roboto,system-ui,-apple-system,'Segoe UI',sans-serif;background:var(--muted);color:#222}
  .page {display:none; height:100vh; width:100vw; align-items:center; justify-content:center; flex-direction:column; text-align:center; padding:28px;}
  .page.active {display:flex}
  /* fade control */
  .fade {opacity:0; transition:opacity 1s ease; pointer-events:none}
  .fade.visible {opacity:1; pointer-events:auto}
  /* welcome */
  #welcome h2{font-weight:400;font-size:28px;margin:0}
  #welcome h1{font-weight:700;font-size:72px;margin:8px 0 0}
  /* titles */
  .title{font-size:36px;font-weight:700;margin-bottom:18px}
  /* button styles */
  .btn{padding:12px 20px;border:0;border-radius:8px;background:var(--green);color:#fff;font-size:16px;cursor:pointer;margin:8px}
  .btn:hover{background:var(--green-dark)}
  .btn.gray{background:var(--gray);cursor:not-allowed}
  .btn.red{background:var(--red)}
  .btn.back{background:#757575}
  .btn.row{display:inline-flex;align-items:center;justify-content:center;min-width:160px}
  /* horizontal groups */
  .row {display:flex;gap:16px;align-items:center;justify-content:center;margin:10px 0}
  /* data text */
  .data p{margin:6px 0;font-size:18px}
  /* panels inside setup */
  .panel{margin-top:18px;padding:16px;background:var(--bg);border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  select,input{padding:10px;font-size:15px;border-radius:6px;border:1px solid #ddd;margin-top:8px;width:220px}
  /* monitor layout */
  .monitor-controls{display:flex;gap:12px;justify-content:center;margin-top:16px}
  /* small-muted */
  .muted{color:#666;font-size:14px;margin-top:8px}
</style>
</head>
<body>

<!-- Welcome -->
<section id="welcome" class="page active fade">
  <h2>Welcome to</h2>
  <h1>Im-Plant</h1>
  <div class="muted" style="margin-top:18px">Interact (scroll / click / key) to continue</div>
</section>

<!-- Home -->
<section id="home" class="page fade">
  <div class="title">Smart Gardening System</div>
  <div class="row">
    <button id="btnSetup" class="btn row">Plant Setup</button>
    <button id="btnHealth" class="btn row" >Plant Health</button>
  </div>
  <div style="margin-top:14px">
    <button id="btnClearAll" class="btn red">Clear Data</button>
  </div>
  <div class="muted">Plant Health is disabled until a plant is selected.</div>
</section>

<!-- Plant Setup -->
<section id="setup" class="page fade">
  <div class="title">Plant Setup</div>

  <div class="panel">
    <div class="data">
      <p>üå°Ô∏è Temperature: <span id="s_temp">--</span> ¬∞C</p>
      <p>üíß Humidity: <span id="s_hum">--</span> %</p>
      <p>‚òÄÔ∏è Light: <span id="s_light">--</span> lx</p>
      <p>üå± Soil Moisture: <span id="s_soil">--</span> %</p>
    </div>

    <div class="row" style="margin-top:12px">
      <button id="optSuggest" class="btn row">Suggest a Plant</button>
      <button id="optAlready" class="btn row">I Already Planted One</button>
    </div>

    <!-- Suggest panel (replaces the choices when active) -->
    <div id="suggestPanel" class="panel" style="display:none; margin-top:14px">
      <p style="font-size:18px">Best plant for your pot:</p>
      <p style="font-size:22px;font-weight:700" id="suggestText">Tomato</p>
      <div class="row" style="margin-top:12px">
        <button id="confirmSuggest" class="btn row">Confirm Plant</button>
        <button id="backFromSuggest" class="btn back row">Back</button>
      </div>
    </div>

    <!-- Existing panel -->
    <div id="existingPanel" class="panel" style="display:none; margin-top:14px">
      <p style="font-size:16px">Select a plant or enter custom name</p>
      <div style="margin-top:8px">
        <select id="plantSelect">
          <option value="Tomato">Tomato</option>
          <option value="Mint">Mint</option>
          <option value="Basil">Basil</option>
          <option value="Chili">Chili</option>
        </select>
      </div>
      <div style="margin-top:8px">
        <input id="plantCustom" placeholder="Custom plant name (optional)" />
      </div>
      <div class="row" style="margin-top:12px">
        <button id="confirmExisting" class="btn row">Confirm Plant</button>
        <button id="backFromExisting" class="btn back row">Back</button>
      </div>
    </div>

    <div style="margin-top:18px">
      <button id="setupBack" class="btn back">Back</button>
    </div>
  </div>
</section>

<!-- Plant Monitor -->
<section id="monitor" class="page fade">
  <div class="title" id="monitorTitle">Monitoring:</div>

  <div class="panel">
    <div class="data">
      <p>üå°Ô∏è Temperature: <span id="m_temp">--</span> ¬∞C</p>
      <p>üíß Humidity: <span id="m_hum">--</span> %</p>
      <p>‚òÄÔ∏è Light: <span id="m_light">--</span> lx</p>
      <p>üå± Soil Moisture: <span id="m_soil">--</span> %</p>
      <p id="healthAdvice" class="muted">Health advice will appear here.</p>
    </div>

    <div class="monitor-controls">
      <button id="waterNow" class="btn row">Water Now üí¶</button>
      <button id="autoMode" class="btn row">Auto Mode: OFF</button>
    </div>

    <div style="margin-top:14px">
      <button id="monitorBack" class="btn back">Back</button>
      <button id="monitorClear" class="btn red">Clear Data</button>
    </div>
  </div>
</section>

<script>
  // sections
  const welcome = document.getElementById('welcome');
  const home = document.getElementById('home');
  const setup = document.getElementById('setup');
  const monitor = document.getElementById('monitor');

  // home controls
  const btnSetup = document.getElementById('btnSetup');
  const btnHealth = document.getElementById('btnHealth');
  const btnClearAll = document.getElementById('btnClearAll');

  // setup controls
  const optSuggest = document.getElementById('optSuggest');
  const optAlready = document.getElementById('optAlready');
  const suggestPanel = document.getElementById('suggestPanel');
  const existingPanel = document.getElementById('existingPanel');
  const confirmSuggest = document.getElementById('confirmSuggest');
  const confirmExisting = document.getElementById('confirmExisting');
  const backFromSuggest = document.getElementById('backFromSuggest');
  const backFromExisting = document.getElementById('backFromExisting');
  const setupBack = document.getElementById('setupBack');

  // monitor controls
  const monitorTitle = document.getElementById('monitorTitle');
  const waterNow = document.getElementById('waterNow');
  const autoMode = document.getElementById('autoMode');
  const monitorBack = document.getElementById('monitorBack');
  const monitorClear = document.getElementById('monitorClear');

  // sensor display elements
  const s_temp = document.getElementById('s_temp');
  const s_hum  = document.getElementById('s_hum');
  const s_light= document.getElementById('s_light');
  const s_soil = document.getElementById('s_soil');

  const m_temp = document.getElementById('m_temp');
  const m_hum  = document.getElementById('m_hum');
  const m_light= document.getElementById('m_light');
  const m_soil = document.getElementById('m_soil');
  const healthAdvice = document.getElementById('healthAdvice');

  const suggestText = document.getElementById('suggestText');
  const plantSelect = document.getElementById('plantSelect');
  const plantCustom = document.getElementById('plantCustom');

  // state
  let plantName = localStorage.getItem('plantName') || null;
  let autoOn = false;

  // helper: show page with fade
  function showPage(pageEl) {
    // hide all
    [welcome, home, setup, monitor].forEach(p => { p.classList.remove('active','visible'); p.style.display='none'; });
    // show requested
    pageEl.style.display = 'flex';
    // allow small tick then fade in
    setTimeout(()=>{ pageEl.classList.add('active'); pageEl.classList.add('visible'); }, 10);
    // allow scroll on non-welcome
    if(pageEl === welcome) document.body.style.overflow = 'hidden'; else document.body.style.overflow = 'auto';
  }

  // welcome logic: fade-in then wait for user input to fade-out
  window.addEventListener('load', ()=> {
    // show welcome visible
    welcome.style.display='flex';
    setTimeout(()=> welcome.classList.add('visible'), 50);

    const proceed = ()=> {
      // fade out welcome (1s)
      welcome.classList.remove('visible');
      // after fade out, show home
      setTimeout(()=> showPage(home), 1000);
      ['wheel','click','keydown','touchstart'].forEach(e=> window.removeEventListener(e, proceed));
    };
    ['wheel','click','keydown','touchstart'].forEach(e=> window.addEventListener(e, proceed, {once:true}));
  });

  // update home health button color/state
  function refreshHomeButtons(){
    if(plantName){
      btnHealth.disabled = false;
      btnHealth.classList.remove('gray');
      btnHealth.style.background = 'var(--green)';
    } else {
      btnHealth.disabled = false; // allow click to show alert per spec? User asked grey and show "No plant data!" -> visually grey and behavior alert
      btnHealth.classList.add('gray');
      btnHealth.style.background = 'var(--gray)';
    }
  }
  refreshHomeButtons();

  // navigation
  btnSetup.addEventListener('click', ()=> {
    // reset panels
    suggestPanel.style.display = 'none';
    existingPanel.style.display = 'none';
    // ensure both choice buttons visible
    optSuggest.style.display = 'inline-flex';
    optAlready.style.display = 'inline-flex';
    showPage(setup);
  });

  btnHealth.addEventListener('click', ()=> {
    if(!plantName){
      alert('No plant data!');
      return;
    }
    showMonitorForPlant();
    showPage(monitor);
  });

  btnClearAll.addEventListener('click', ()=> {
    localStorage.removeItem('plantName');
    plantName = null;
    refreshHomeButtons();
    alert('All data cleared.');
  });

  // setup options
  optSuggest.addEventListener('click', ()=> {
    // remove the "I Already Planted One" option per spec
    optAlready.style.display = 'none';
    // compute suggestion based on current sensor values (simple logic)
    const t = parseFloat(s_temp.textContent) || 25;
    const l = parseFloat(s_light.textContent) || 500;
    const soil = parseFloat(s_soil.textContent) || 50;
    let suggested = 'Tomato';
    if(t < 20) suggested = 'Mint';
    else if(l < 200) suggested = 'Fern';
    else if(soil < 35) suggested = 'Cactus';
    suggestText.textContent = suggested;
    suggestPanel.style.display = 'block';
  });

  backFromSuggest.addEventListener('click', ()=> {
    // return to setup choices. Restore the "I Already Planted One" button
    suggestPanel.style.display = 'none';
    optAlready.style.display = 'inline-flex';
  });

  optAlready.addEventListener('click', ()=> {
    // show selection panel, keep both buttons visible until user enters existing panel
    existingPanel.style.display = 'block';
    suggestPanel.style.display = 'none';
  });

  backFromExisting.addEventListener('click', ()=> {
    existingPanel.style.display = 'none';
  });

  setupBack.addEventListener('click', ()=> {
    showPage(home);
  });

  confirmSuggest.addEventListener('click', ()=>{
    plantName = suggestText.textContent;
    localStorage.setItem('plantName', plantName);
    refreshHomeButtons();
    showMonitorForPlant();
    showPage(monitor);
  });

  confirmExisting.addEventListener('click', ()=>{
    const sel = plantSelect.value;
    const custom = plantCustom.value.trim();
    plantName = custom || sel;
    if(!plantName){ alert('Enter or select a plant.'); return; }
    localStorage.setItem('plantName', plantName);
    refreshHomeButtons();
    showMonitorForPlant();
    showPage(monitor);
  });

  // monitor controls
  function showMonitorForPlant(){
    monitorTitle.textContent = 'Monitoring: ' + (plantName || '‚Äî');
    // update immediate sensor numbers too
    updateMonitorDisplays();
    updateHealthAdvice();
  }

  waterNow.addEventListener('click', ()=> {
    // placeholder action; in real app trigger pump via Firebase
    alert('Water pump activated (manual).');
  });

  autoMode.addEventListener('click', ()=> {
    // non-functional toggle (per spec). Just change label.
    autoOn = !autoOn;
    autoMode.textContent = 'Auto Mode: ' + (autoOn ? 'ON' : 'OFF') + (autoOn ? ' (not active)' : '');
  });

  monitorBack.addEventListener('click', ()=> {
    showPage(home);
  });

  monitorClear.addEventListener('click', ()=> {
    localStorage.removeItem('plantName');
    plantName = null;
    refreshHomeButtons();
    showPage(home);
  });

  // Simulated sensor updates. Replace with Firebase reading as needed.
  function randomBetween(a,b){ return a + Math.random()*(b-a) }
  function updateSensorSim(){
    const t = (randomBetween(23,28)).toFixed(1);
    const h = Math.round(randomBetween(40,80));
    const l = Math.round(randomBetween(200,900));
    const soil = Math.round(randomBetween(25,65));
    // update setup displays
    s_temp.textContent = t;
    s_hum.textContent = h;
    s_light.textContent = l;
    s_soil.textContent = soil;
    // update monitor displays
    m_temp.textContent = t;
    m_hum.textContent = h;
    m_light.textContent = l;
    m_soil.textContent = soil;
    updateHealthAdvice();
  }

  function updateMonitorDisplays(){
    // if values present in setup, copy them; else show placeholders
    m_temp.textContent = s_temp.textContent || '--';
    m_hum.textContent = s_hum.textContent || '--';
    m_light.textContent = s_light.textContent || '--';
    m_soil.textContent = s_soil.textContent || '--';
  }

  function updateHealthAdvice(){
    const soil = parseFloat(m_soil.textContent) || parseFloat(s_soil.textContent) || 0;
    const light = parseFloat(m_light.textContent) || parseFloat(s_light.textContent) || 0;
    if(soil && soil < 30) healthAdvice.textContent = 'Soil is dry ‚Äî water the plant.';
    else if(light && light < 200) healthAdvice.textContent = 'Low light detected ‚Äî move plant to sunlight.';
    else healthAdvice.textContent = 'Ideal conditions ‚Äî keep it up!';
  }

  // run simulation every 2s
  updateSensorSim();
  setInterval(updateSensorSim, 2000);

  // ensure home button state rendered on load
  refreshHomeButtons();

  // small accessibility: if user clicks health while gray, show alert
  btnHealth.addEventListener('click', ()=> {
    if(!localStorage.getItem('plantName')) {
      // already handled above; keep here for safety
      if(confirm){} // noop
    }
  });

</script>
</body>
</html>
