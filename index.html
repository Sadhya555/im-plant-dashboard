<html>
  <head>
    <meta charset="UTF-8" />
    <title>Im-Plant | Smart Gardening System</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: 'Roboto', sans-serif;
        background: #f5f5f5;
        color: #222;
        overflow: hidden; /* locked initially */
        text-align: center;
      }

      section {
        min-height: 100vh;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 1s ease;
        padding: 40px;
      }

      section.active {
        display: flex;
        opacity: 1;
      }

      button {
        margin: 8px;
        padding: 12px 24px;
        font-size: 18px;
        border: none;
        border-radius: 6px;
        background-color: #4CAF50;
        color: white;
        cursor: pointer;
      }
      button:disabled {
        background-color: #aaa;
        cursor: not-allowed;
      }

      select, input {
        padding: 10px;
        font-size: 16px;
        margin: 8px;
      }

      hr { width: 60%; margin: 40px 0; }

      /* welcome section */
      #welcome h2 {
        font-weight: 400;
        font-size: 28px;
        margin: 0;
      }
      #welcome h1 {
        font-weight: 700;
        font-size: 96px;
        margin: 10px 0 0 0;
      }
    </style>
  </head>

  <body>
    <!-- 0. WELCOME -->
    <section id="welcome">
      <h2>Welcome to</h2>
      <h1>Im-Plant</h1>
    </section>

    <!-- 1. HOME -->
    <section id="home">
      <h1>Smart Gardening System</h1>
      <div>
        <button id="goToSetup">Go to Plant Setup</button>
        <button id="goToHealth" disabled>Check Plant Health</button>
      </div>
      <button id="clearData" style="margin-top:20px; background-color:#f44336;">Clear Plant Data</button>
    </section>

    <!-- 2. PLANT SETUP -->
    <section id="setup">
      <h1>Plant Selection or Suggestion</h1>
      <div id="suggestSection">
        <h2>Suggest a Plant</h2>
        <p>Temperature: <span id="temp"></span> ¬∞C</p>
        <p>Humidity: <span id="hum"></span> %</p>
        <p>Light: <span id="light"></span> lx</p>
        <p>Moisture: <span id="soil"></span></p>
        <button id="suggestBtn">Suggest</button>
        <p id="suggestResult"></p>
        <button id="confirmSuggested" disabled>Confirm Plant</button>
      </div>
      <hr>
      <div id="selectSection">
        <h2>I Already Planted One</h2>
        <select id="plantList">
          <option value="">Select Plant</option>
          <option>Tomato</option>
          <option>Rose</option>
          <option>Mint</option>
          <option>Chili</option>
        </select><br>
        <input type="text" id="customPlant" placeholder="Custom Plant Name (optional)">
        <br>
        <button id="confirmSelected">Confirm Plant</button>
      </div>
      <button id="backHome" style="margin-top:30px;">‚¨Ö Back</button>
    </section>

    <!-- 3. PLANT HEALTH -->
    <section id="health">
      <h1>Monitor and Maintain Plant Health</h1>
      <h2 id="plantName">Monitoring:</h2>
      <p>Temperature üå°Ô∏è: <span id="hTemp"></span> ¬∞C</p>
      <p>Humidity üíß: <span id="hHum"></span> %</p>
      <p>Light ‚òÄÔ∏è: <span id="hLight"></span> lx</p>
      <p>Soil üå±: <span id="hSoil"></span></p>
      <h3 id="healthMsg"></h3>
      <div>
        <button id="waterBtn">Water Now üí¶</button>
        <button id="autoMode">Auto Mode: OFF</button>
      </div>
      <button id="backSetup" style="margin-top:30px;">‚¨Ö Back</button>
    </section>

    <script>
      // Firebase init
      const firebaseConfig = {
        apiKey: "AIzaSyA2lx9dz9n_U3yjGzedewfYx_zHRp-qKRY",
        databaseURL: "https://im-plant-bracu-default-rtdb.asia-southeast1.firebasedatabase.app/"
      };
      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      // Section refs
      const sections = {
        welcome: document.getElementById("welcome"),
        home: document.getElementById("home"),
        setup: document.getElementById("setup"),
        health: document.getElementById("health")
      };

      function show(id) {
        for (const s of Object.values(sections)) s.classList.remove("active");
        sections[id].classList.add("active");
      }

      // Welcome logic
      window.onload = () => {
        show("welcome");
        document.body.style.overflow = "hidden";
        setTimeout(() => sections.welcome.classList.add("active"), 100);

        // Wait for user input to continue
        const proceed = () => {
          sections.welcome.classList.remove("active");
          setTimeout(() => {
            show("home");
            document.body.style.overflow = "auto"; // enable scroll later
          }, 1000);
          ["wheel","click","keydown","touchstart"].forEach(e => window.removeEventListener(e, proceed));
        };
        ["wheel","click","keydown","touchstart"].forEach(e =>
          window.addEventListener(e, proceed, { once:true })
        );
      };

      // State
      let selectedPlant = localStorage.getItem("plant") || null;
      let auto = false;
      if (selectedPlant) document.getElementById("goToHealth").disabled = false;

      // Navigation
      document.getElementById("goToSetup").onclick = () => show("setup");
      document.getElementById("goToHealth").onclick = () => show("health");
      document.getElementById("backHome").onclick = () => show("home");
      document.getElementById("backSetup").onclick = () => show("setup");

      document.getElementById("clearData").onclick = () => {
        localStorage.removeItem("plant");
        selectedPlant = null;
        document.getElementById("goToHealth").disabled = true;
        alert("Plant data cleared.");
      };

      // Firebase live read
      let sensorData = {};
      db.ref("/garden").on("value", snap => {
        sensorData = snap.val() || {};
        ["temp","hum","light","soil"].forEach(k => {
          document.getElementById(k).textContent = sensorData[k === "temp" ? "temperature" : k] || "-";
          document.getElementById("h" + k.charAt(0).toUpperCase() + k.slice(1)).textContent = sensorData[k === "temp" ? "temperature" : k] || "-";
        });
        updateHealthMessage();
      });

      // Suggestion logic
      document.getElementById("suggestBtn").onclick = () => {
        const { temperature, humidity, light, soil } = sensorData;
        let plant = "Tomato";
        if (temperature < 20) plant = "Mint";
        else if (light < 200) plant = "Fern";
        else if (soil < 40) plant = "Cactus";

        document.getElementById("suggestResult").textContent = "Best plant for your pot: " + plant;
        const btn = document.getElementById("confirmSuggested");
        btn.disabled = false;
        btn.dataset.plant = plant;
      };

      document.getElementById("confirmSuggested").onclick = e => {
        selectedPlant = e.target.dataset.plant;
        savePlant();
      };

      document.getElementById("confirmSelected").onclick = () => {
        const listVal = document.getElementById("plantList").value;
        const customVal = document.getElementById("customPlant").value.trim();
        selectedPlant = customVal || listVal;
        if (!selectedPlant) return alert("Select or enter a plant first.");
        savePlant();
      };

      function savePlant() {
        localStorage.setItem("plant", selectedPlant);
        document.getElementById("goToHealth").disabled = false;
        document.getElementById("plantName").textContent = "Monitoring: " + selectedPlant;
        show("health");
      }

      // Health logic
      function updateHealthMessage() {
        const msg = document.getElementById("healthMsg");
        if (!sensorData.soil) return (msg.textContent = "");
        if (sensorData.soil < 30) msg.textContent = "Soil is dry ‚Äî water the plant.";
        else if (sensorData.light < 200) msg.textContent = "Low light detected ‚Äî move plant to sunlight.";
        else msg.textContent = "Ideal conditions ‚Äî keep it up!";
      }

      document.getElementById("waterBtn").onclick = () => alert("Pump activated manually.");
      document.getElementById("autoMode").onclick = e => {
        auto = !auto;
        e.target.textContent = "Auto Mode: " + (auto ? "ON" : "OFF");
      };
    </script>
  </body>
</html>
